
## ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è CRITICAL: PL.csv & OVH.csv - P&L DATASETS ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**DATASETS:**
- **PL.csv** = Profit & Loss statement (agregovan√© √∫ƒçty)
- **OVH.csv** = Detailed expense documents (jednotliv√© doklady)

**VALUES ARE NEGATIVE** (expenses are shown as negative numbers):
- Energy: -14,280.54 CZK
- Materials: -2,744.81 CZK
- DO NOT convert to positive! Keep negative values!

---

### **PL.csv STRUCTURE - EXPENSE HIERARCHY:**

**Account classification:**

Account class = 5 ‚Üí ALL expenses (v≈°echny n√°klady)

Acc-Level 1 ‚Üí TOP CATEGORY (exact values in PL.csv):
  - "Re≈æijn√≠ n√°klady" (overhead costs) ‚Üê MOST COMMON!
  - "N√°klady na zbo≈æ√≠" (cost of goods sold)
  - "Reklama" (marketing/advertising)
  - "Finanƒçn√¨ v√Ωnosy a n√°klady" (financial income/expenses)
  - "IC v√Ωnosy a n√°klady mimo zbo≈æ√≠" (intercompany)
  - "Mimo≈ô√°dn√© v√Ωnosy a n√°klady" (extraordinary items)
  - "SK finanƒçn√≠ n√°klady" (SK financial costs)
  - "Bad Debt Provision" (provisions)
  - "V√Ωnosy reporting" (revenue reporting)
  - "Missing value" (uncategorized)

Acc-Level 2 ‚Üí SUB-CATEGORY:
  - "Spot≈ôeba materi√°lu a slu≈æeb"
  - "Person√°ln√≠ n√°klady"
  - "Budovy a za≈ô√≠zen√≠"
  - etc.

Acc-Level 3 ‚Üí DETAIL:
  - "Materi√°l", "Energie", "Cestovn√©", "Telefony, internet, po≈°tovn√©", etc.

**Analytical account - name** = Detailed description (e.g., "Spot≈ôeba energie - elekt≈ôina")

---

### **üî¥ CRITICAL FILTERING RULES:**

**WHEN USER ASKS:**

1. **"Re≈æijn√≠ n√°klady"** ‚Üí Filter: Acc-Level 1 == "Re≈æijn√≠ n√°klady"
   ```python
   pl_regime = pl[pl['Acc-Level 1'] == 'Re≈æijn√≠ n√°klady']
   ```

2. **"N√°klady na energii"** ‚Üí Filter: Acc-Level 3 == "Energie" OR Analytical account - name contains "energie"
   ```python
   pl_energy = pl[(pl['Acc-Level 3'] == 'Energie') | 
                  (pl['Analytical account - name'].str.contains('energie', case=False, na=False))]
   ```

3. **"V≈°echny n√°klady"** / "Celkov√© n√°klady" ‚Üí Filter: Account class == 5
   ```python
   pl_all = pl[pl['Account class'] == 5]
   ```

4. **"N√°klady na cestovn√©"** ‚Üí Filter: Acc-Level 3 == "Cestovn√©" OR fuzzy match in Analytical account - name

5. **"N√°klady podle st≈ôedisek"** ‚Üí Group by CC-Level 1 (cost center)
   ```python
   result = pl.groupby('CC-Level 1')[date_cols].sum()
   ```

---

### **üî¥ CRITICAL - FUZZY MATCHING FOR Acc-Level 1:**

When user asks for expense category, use case-insensitive partial matching:

**User says ‚Üí Filter:**
- "re≈æijn√≠" ‚Üí pl[pl['Acc-Level 1'].str.contains('re≈æijn√≠', case=False, na=False)]
- "n√°klady na zbo≈æ√≠" ‚Üí pl[pl['Acc-Level 1'].str.contains('zbo≈æ√≠', case=False, na=False)]
- "reklama" ‚Üí pl[pl['Acc-Level 1'].str.contains('reklam', case=False, na=False)]
- "finanƒçn√≠" ‚Üí pl[pl['Acc-Level 1'].str.contains('finanƒç', case=False, na=False)]

**ALWAYS use fuzzy matching, NOT exact match!**

---

### **KEY DIMENSIONS:**

**Organization:**
- Accounting unit name = Company (Alza.at GmbH, Alza.cz s.r.o., etc.)

**Cost Centers:**
- CC-Level 1 = Main cost center (ALZABOX, CENTR√ÅLA, NAKUP, LOGISTIKA, etc.)

**Accounts:**
- Account class = Account type (5 = expenses)
- Analytical account = Account number (501 200, 502 100, etc.)
- Acc-Level 1/2/3 = Hierarchy of expense categories
- Account class - name = "N√°klady"
- Analytical account - name = Detailed description

---

### **OVH.csv EXTRA DIMENSIONS:**

OVH.csv has same structure as PL.csv PLUS:

- CC-Level 2 = Sub cost center (ALZABOX_AT, ALZABOX_CZ, etc.)
- Customer/company name = **SUPPLIER** (Figolock s.r.o., KPK Reklama, etc.)
  - ‚ö†Ô∏è NOT customer! This is the VENDOR/SUPPLIER!
- Electronic document key = Invoice number (ELD7204100, ELD5724723, etc.)
- Document item description = Item detail ("Small material", "Stickers", etc.)
- Project key = Project code (PROJ18826, PROJ-1, etc.)

**WHEN USER ASKS:**
- "Top dodavatel√©" / "Top suppliers" ‚Üí Group by Customer/company name (it's supplier!)
- "Projekt PROJ18826" ‚Üí Filter: Project key == "PROJ18826"
- "Doklad ELD..." ‚Üí Filter: Electronic document key == "ELD..."

---

### **DATE COLUMNS:**
- PL.csv: 01.01.2024 through 01.12.2025 (WIDE format)
- OVH.csv: 01.01.2024 through 01.11.2025 (WIDE format)
- Same structure as Sales.csv!

---

### **EXAMPLES:**

**Example 1: Re≈æijn√≠ n√°klady podle st≈ôedisek**
```python
Query: "Re≈æijn√≠ n√°klady podle st≈ôedisek v lednu 2024"

# ‚úÖ CORRECT:
pl_regime = pl[pl['Acc-Level 1'] == 'Re≈æijn√≠ n√°klady']
result = pl_regime.groupby('CC-Level 1')['01.01.2024'].sum()

# ‚ùå WRONG:
pl_all = pl[pl['Account class'] == 5]  # This gets ALL expenses, not just re≈æijn√≠!
```

**Example 2: N√°klady na energii**
```python
Query: "N√°klady na energii v roce 2024"

# ‚úÖ CORRECT:
pl_energy = pl[(pl['Acc-Level 3'] == 'Energie') | 
               (pl['Analytical account - name'].str.contains('energie', case=False, na=False))]

date_cols_2024 = [col for col in pl_energy.columns if '2024' in col]
total = pl_energy[date_cols_2024].sum().sum()
```

**Example 3: Top dodavatel√© (OVH.csv)**
```python
Query: "Top 5 dodavatel≈Ø podle n√°klad≈Ø v roce 2024"

# ‚úÖ Use OVH.csv, not PL.csv!
ovh = OVH.copy()

date_cols_2024 = [col for col in ovh.columns if '2024' in col]
suppliers = ovh.groupby('Customer/company name')[date_cols_2024].sum(axis=1)
top5 = suppliers.nlargest(5)  # Most negative = highest costs
```

---

### **‚ö†Ô∏è IMPORTANT NOTES:**

1. **Negative values = expenses** - DO NOT convert to positive!
2. **"Customer/company name" in OVH.csv = SUPPLIER**, not customer!
3. **Always filter by Acc-Level hierarchy** when user mentions specific expense category
4. **Use fuzzy matching** for expense names (case-insensitive, partial match)
5. **Missing value** in OVH.csv Customer/company name = Unknown supplier

